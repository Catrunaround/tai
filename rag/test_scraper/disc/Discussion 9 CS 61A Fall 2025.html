
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="description" content ="CS 61A: Structure and Interpretation of Computer Programs" />
    <meta name="keywords" content ="Computer Science, Programming, Berkeley, EECS" />
    <meta name="author" content ="John DeNero, Kay Ousterhout" />
    <!-- CHANGED CAREFUL -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="/assets/js/hl.js"></script>
    <script src="/assets/js/toggledarkmode.js"></script>
    <script>
        // we aren't registering builtins since
        //      (1) they don't render differently in the current CSS from other names
        //      (2) it's a mess to list all of them. You can extract from the site but that takes effort
        // if (1) ceases to be true, (2) might be worth the effort. For now, we're leaving as is
        hljsRegister({
            'keyword': "define if cond and or let begin lambda mu quote delay cons-stream set! quasiquote unquote unquote-splicing define-macro"
        });
        hljs.initHighlightingOnLoad();
    </script>
    <script src="/assets/js/dark-mode.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,500|Work+Sans:400,700">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/mono-blue.css">
    <link rel="icon" href="/assets/images/favicon.ico">

    

<link rel="stylesheet" type="text/css" href="/assets/css/disc.css">


    <title>
Discussion 9 | CS 61A Fall 2025
</title>
  </head>

  <body id="index" class="home">
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container noselect">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-section" aria-label="Toggle Navigation Bar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">
            CS 61A
            <!-- <img style="max-width:60px; margin-top: -20px;" class="logo" src="/assets/images/logo.png"/> -->
          </a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-section">
          <ul class="nav navbar-nav navbar-right">

            
            <li><a href="/">Lectures</a></li>
            
            <li><a href="/articles/about-61a/">Syllabus</a></li>
            
            <li><a href="https://edstem.org/us/courses/82739/discussion">Ed</a></li>
            
            <li><a href="/office-hours/">Office Hours</a></li>
            
            <li><a href="/articles/contact-61a/">Contact</a></li>
            

            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Links
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                <li><a href="https://go.cs61a.org/extensions">Request an Extension</a></li>
                
                <li><a href="https://go.cs61a.org/regrades">Request a Regrade</a></li>
                
                <li><a href="https://oh.cs61a.org/">Office Hours Queue</a></li>
                
                <li><a href="">Gradescope</a></li>
                
                <li><a href="https://sections.cs61a.org">Add/Change Sections</a></li>
                
                <li><a href="https://bcourses.berkeley.edu/courses/1547573/pages">Lecture Recordings</a></li>
                
                <li><a href="https://pythontutor.com/cp/composingprograms.html">Python Tutor</a></li>
                
                <li><a href="https://code.cs61a.org/">Code Editors</a></li>
                
              </ul>
            </li>
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                <li><a href="/resources/">Past Exams & Websites</a></li>
                
                <li><a href="https://www.composingprograms.com">Textbook</a></li>
                
                <li><a href="/articles/campus-res/">Campus Resources</a></li>
                
                <li><a href="/articles/advice/">Advice from Students</a></li>
                
                <li><a href="/articles/scheme-spec/">Scheme Specifications</a></li>
                
                <li><a href="/articles/scheme-builtins/">Scheme Built-In Procedures</a></li>
                
              </ul>
            </li>
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Guides
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                <li><a href="https://drive.google.com/file/d/1O72u0ml65pibcjz-PXKpqeJDKaVqQ3D8/view">Debugging Guide</a></li>
                
                <li><a href="/articles/studying/">Studying Guide</a></li>
                
                <li><a href="/articles/type-hints/">Type Hints</a></li>
                
                <li><a href="/articles/composition/">Composition Guide</a></li>
                
                <li><a href="/assets/pdfs/61a-mt1-study-guide.pdf">MT1 Study Guide</a></li>
                
                <li><a href="/assets/pdfs/61a-mt2-study-guide.pdf">MT2 Study Guide</a></li>
                
                <li><a href="/assets/pdfs/61a-final-study-guide.pdf">Final Study Guide</a></li>
                
              </ul>
            </li>
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Staff
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                <li><a href="/instructor">Instructors</a></li>
                
                <li><a href="/staff">TAs & Tutors</a></li>
                
                <li><a href="/academic-interns">Academic Interns</a></li>
                
              </ul>
            </li>
            

          </ul>
        </div>
      </div>
    </nav>

    <main id="content" class="container">
      
<div class='row'>
  <div class='col-md-9'>
    <header>
      <h1>
        
Discussion 9: Concurrency

        
        
        <ul class="inline-block list-inline">
          <li><a href="disc09.pdf" class="label label-outline">disc09.pdf</a></li>
        </ul>
        
        
      </h1>
    </header>
    

<!-- <div class="alert storable-login-status"></div> -->


    
<p>If there are fewer than 3 people in your group, merge your group with another group in the room. If your group has 6 or more students, you're welcome to split into two sub-groups and then sync up at the end. If you want two separate Pensieve documents for the two sub-groups, just have one sub-group add 1000 to their group number.</p>

<p>Switch to Pensieve:</p>

<ul>
  <li><strong>Everyone</strong>: Go to <a href="https://www.pensieve.co/student/courses/cs61a/clazzes/cs61a_fa25/assignments/ee850773-fd38-4b91-9627-9aa5c3a5b7e6">pensieve.co</a>, log in with your @berkeley.edu email, and <strong>enter your group number</strong> as the room number (which was in the email that assigned you to this discussion). As long as you all enter the same number (any number), you'll all be using a shared document.</li>
</ul>

<p>Once you're on Pensieve, you don't need to return to this page; Pensieve has all the same content (but more features). If for some reason Penseive doesn't work, return to this page and continue with the discussion.</p>


<h1 id="attendance">Attendance</h1>


<p>Your TA will come around during discussion to check you in. You can start on the worksheet before being checked in; you don't need to wait for your TA to get started.</p>

<p>If you didn't attend for a good reason (such as being sick), fill out this form (within 2 weeks of your discussion): <a href="https://go.cs61a.org/discussion-attendance">attendance form</a></p>


<h1 id="getting-started">Getting Started</h1>


<p><strong>Intros:</strong> Say your name and your favorite food or beverage to enjoy in Berkeley.  Optionally go have that food or beverage as a group after section!</p>


<h1 id="python-coroutines">Python Coroutines</h1>


<ul>
  <li>An <code>async def</code> statement creates a <em>coroutine function</em>. Calling it creates a coroutine.</li>
  <li>Within a coroutine function, <code>await</code> another coroutine (or other <em>awaitable</em> object) to pause the current coroutine and only start it again some time after the awaited coroutine returns. Use <code>x = await c</code> to assign <code>x</code> to the return value of the coroutine <code>c</code>.</li>
  <li>After an <code>await</code>, mutable objects passed into a coroutine may have been changed by another coroutine.</li>
  <li>To start some first coroutine <code>c</code>, use <code>asyncio.run(c)</code>.</li>
  <li>To pause the current coroutine for <code>k</code> seconds and let other coroutines run, use <code>await asyncio.sleep(k)</code>.</li>
  <li><p>To run two coroutines <code>c</code> and <code>d</code> concurrently until both return and name their return values <code>c_val</code> and <code>d_val</code>:</p>

  <p><code>c_val, d_val = await asyncio.gather(c, d)</code></p></li>
</ul>


        <button id='toggle-1' class='btn btn-outline btn-lg alwaystoggle toggle'>
        Details & Example<noscript> (enable JavaScript)</noscript>
        </button>
        <div class="solution toggle-1">

<p><code>async def my_function</code>: Writing <code>async</code> before <code>def</code> indicates that the function is a <em>coroutine function</em>.  Similar to generator functions, when a coroutine function is called, the function does not begin executing.  Instead, calling a coroutine function returns a coroutine object.</p>

<p><code>await</code>: The <code>await</code> keyword pauses execution of the current coroutine until an awaitable object has completed.  For this course, we'll focus on <code>await</code>ing coroutines, which are one type of awaitable object.  An <code>await</code> expression may only be used within a coroutine. It  suspends execution of the current coroutine until some time after the coroutine object (or other awaitable object) following the <code>await</code> keyword has completed.</p>

<p>The <code>asyncio.sleep</code> coroutine suspends execution until the passed-in number of seconds have elapsed.</p>

<p>The following code defines a coroutine function <code>wait_for</code> that pauses execution until <code>seconds</code> have passed:</p>

<pre><code>async def wait_for(seconds):
    await asyncio.sleep(seconds)</code></pre>



<p>Coroutines must be run within an <em>event loop</em>.  The event loop manages the execution of coroutines, and executes a single coroutine at a time. When the currently running coroutine yields control by calling <code>await</code>, the event loop executes another coroutine, if one is available.  To start an event loop, use the <code>asyncio.run</code> function:</p>

<pre><code>asyncio.run(wait_for(5))</code></pre>



<p>To run many coroutines concurrently, use <code>asyncio.gather</code>, which runs the given coroutines concurrently and waits until all have completed.</p>

<pre><code>async def concurrent_wait_fors():
    await asyncio.gather(wait_for(5), wait_for(5), wait_for(5))</code></pre>



<p><code>wait_for</code> uses <code>await</code> to sleep for the given number of seconds, which allows all three of these <code>wait_for</code> calls to sleep at the same time.
</div></p>


<h3 id="q1-understanding-concurrent-execution">Q1: Understanding Concurrent Execution</h3>


<p>The following code starts 3 coroutines that each use the <code>wait_for</code> function above to sleep for different amounts of time.</p>

<pre><code>import asyncio

async def wait_for(seconds):
    await asyncio.sleep(seconds)

async def go():
    await asyncio.gather(wait_for(5), wait_for(3), wait_for(4))

asyncio.run(go())</code></pre>



<p>How many seconds does this code take to run?</p>


        <button id='toggle-2' class='btn btn-outline btn-lg alwaystoggle toggle'>
        Solution<noscript> (enable JavaScript)</noscript>
        </button>
        <div class="solution toggle-2">
5
</div>


<h1 id="implementing-a-wwpd-race">Implementing a WWPD Race</h1>



<h3 id="q2-status">Q2: Status</h3>


<p>Here's a class that can be used to coordinate two different coroutines using a shared object.</p>

<p>The <code>Status</code> class keeps track of whether some operation is finished.</p>

<p>The <code>is_done</code> method returns a boolean indicating whether the operation that a <code>Status</code> represents is done or not.  When a <code>Status</code> is newly created, <code>is_done()</code> returns <code>False</code>.</p>

<p>The <code>done</code> method indicates that the operation that a <code>Status</code> represents has completed.  After <code>done</code> is called on a <code>Status</code>, all future calls to <code>is_done</code> return <code>True</code>.</p>


            <div class="monaco-storable" id="status-input" style="height:378px;"></div>
            <!-- <a href="javascript:void" id="modal-link-status-input">Run in 61A Code</a> -->
            <div class="modal fade" id="modal-status-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-status-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor('class Status:\n    &quot;&quot;&quot;A Status represents whether some operation is complete.\n\n    &gt;&gt;&gt; s = Status()\n    &gt;&gt;&gt; s.is_done()\n    False\n    &gt;&gt;&gt; s.done()\n    &gt;&gt;&gt; s.is_done()\n    True\n    &quot;&quot;&quot;\n    def __init__(self):\n        ____\n\n    def is_done(self) &#x2d;&gt; bool:\n        return ____\n\n    def done(self):\n        ____\n\n', "python", "status-input"));
            </script>
        


<h3 id="q3-wait-for-user-input">Q3: Wait for User Input</h3>


<p>Implement the coroutine function <code>get_user_input</code>, which takes a <code>Status</code> instance.  It waits for one line of user input, marks the <code>status</code> as done, and returns the user input.</p>


            <div class="monaco-storable" id="get_user_input-input" style="height:234px;"></div>
            <!-- <a href="javascript:void" id="modal-link-get_user_input-input">Run in 61A Code</a> -->
            <div class="modal fade" id="modal-get_user_input-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-get_user_input-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor('import sys\n\nasync def get_user_input(status: Status) &#x2d;&gt; str:\n    # Read one line of user input\n    # Using &quot;await&quot; means that we&#x27;re giving up control\n    # and letting other coroutines run while we wait for\n    # user input.\n    result = await asyncio.to_thread(sys.stdin.readline)\n    ____ # Update status\n    return ____\n\n', "python", "get_user_input-input"));
            </script>
        


<h3 id="q4-timer">Q4: Timer</h3>


<p>The coroutine function <code>timer</code> takes a <code>status</code> and a positive number <code>period</code>. It repeatedly prints out how many seconds have elapsed, once every <code>period</code> seconds, until it detects that the <code>status</code> is done.  The first message it prints is <code>0 seconds have passed...</code>.  While it's waiting to print the next message, it uses <code>await</code> so that other coroutines can run concurrently. It returns the number of seconds that passed before it observes that the <code>status</code> is done, which should be a multiple of <code>period</code>.</p>

<p>When printing that 1 second has passed, use <code>1 second has passed...</code> instead of <code>1 seconds have passed...</code> to respect the grammar of English.</p>

<p>For example:</p>

<pre><code>async def timer_example():
    &quot;&quot;&quot;An example of using a timer.

    &gt;&gt;&gt; asyncio.run(timer_example())
    0 seconds have passed...
    0.5 seconds have passed...
    1 second has passed...
    1.5 seconds have passed...
    Status updated after 1.7 seconds
    The timer counted up to 2.0 seconds
    &quot;&quot;&quot;
    async def update_status(status: Status):
        await asyncio.sleep(1.7)
        print(&#x27;Status updated after 1.7 seconds&#x27;)
        status.done()

    status = Status()
    _, elapsed = await asyncio.gather(update_status(status), timer(status, 0.5))
    print(f&#x27;The timer counted up to {elapsed} seconds&#x27;)</code></pre>



<alwaystoggle prompt="Hint">
<code>await</code> a call to <code>asyncio.sleep</code> within the <code>while</code> statement in order to allow other coroutines to run during that time.
</alwaystoggler>


            <div class="monaco-storable" id="timer-input" style="height:234px;"></div>
            <!-- <a href="javascript:void" id="modal-link-timer-input">Run in 61A Code</a> -->
            <div class="modal fade" id="modal-timer-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-timer-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor('async def timer(status: Status, period):\n    &quot;&quot;&quot;Print a message every period seconds until status.is_done().&quot;&quot;&quot;\n    time_passed = 0\n    while ____:\n        if ____:\n            print(&#x27;1 second has passed...&#x27;)\n        else:\n            print(f&#x27;{____} seconds have passed...&#x27;)\n        time_passed ____\n        ____\n    return time_passed\n', "python", "timer-input"));
            </script>
        

<p><strong>Discussion time:</strong> Why do we need the <code>Status</code> class instead of passing in a <code>bool</code> called <code>status</code> in order to ensure that the <code>timer</code> eventually stops?</p>


<h3 id="q5-what-would-python-do">Q5: What Would Python Do</h3>


<p><code>timer</code> and <code>get_user_input</code> can be used together to write a new function <code>wwpd</code> that waits for user input while printing out how much time has elapsed every second.  <code>wwpd</code> works similarly to the "What Would Python Do" questions in lab: it presents the user with a Python expression and waits for the user to enter a response.  Unlike lab, our <code>wwpd</code> uses <code>timer</code> to tell the user how long they have taken to respond.</p>

<p>Your solution will need to assign the name <code>response</code> to what the user entered, and <code>seconds</code> to the elapsed time returned by <code>timer</code>.</p>

<p><strong>Tip:</strong> <code>asyncio.gather</code> returns a list of the return values of the passed-in coroutines.  Values are returned in the same order that the corresponding coroutines were passed into <code>asyncio.gather</code>, not the order they finished.</p>


            <div class="monaco-storable" id="wwpd-input" style="height:774px;"></div>
            <!-- <a href="javascript:void" id="modal-link-wwpd-input">Run in 61A Code</a> -->
            <div class="modal fade" id="modal-wwpd-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-wwpd-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor('async def wwpd(challenge: str):\n    &quot;&quot;&quot;Run a WWPD interface.\n\n    &gt;&gt;&gt; simulate_user_input(5, 2.5) # simulate a user entering 5 after 2.5 seconds\n    &gt;&gt;&gt; asyncio.run(wwpd(&#x27;2 + 3&#x27;))\n    What is 2 + 3\n    0 seconds have passed...\n    1 second has passed...\n    2 seconds have passed...\n    5\n    The user waited 3 seconds to correctly respond with 5\n\n    &gt;&gt;&gt; simulate_user_input(6, 1.5) # simulate a user entering 6 after 1.5 seconds\n    &gt;&gt;&gt; asyncio.run(wwpd(&#x27;2 + 3&#x27;))\n    What is 2 + 3\n    0 seconds have passed...\n    1 second has passed...\n    6\n    The user waited 2 seconds to incorrectly respond with 6\n    &quot;&quot;&quot;\n    print(&#x27;What is&#x27;, challenge)\n    "*** YOUR CODE HERE ***"\n\n    # Get the correct answer, and compare it to the user input.\n    correct_answer = eval(challenge)\n    if str(correct_answer) == response.strip():\n        print(f&#x27;The user waited {seconds} seconds to correctly respond with {response}&#x27;)\n    else:\n        print(f&#x27;The user waited {seconds} seconds to incorrectly respond with {response}&#x27;)\n\ndef simulate_user_input(response, time):\n    &quot;&quot;&quot;Simulate a user response after an amount of time. This is just for testing.&quot;&quot;&quot;\n    async def f(status):\n        await asyncio.sleep(time)\n        status.done()\n        print(response)\n        return str(response)\n    global get_user_input\n    get_user_input = f\n', "python", "wwpd-input"));
            </script>
        


<h3 id="q6-wwpd-race">Q6: WWPD Race</h3>


<p>Now we'll implement a race to solve WWPD questions faster than an opponent.  Implement <code>run_challenges</code>, a coroutine function that has a player repeatedly evaluate expressions. It takes the following arguments:</p>

<ul>
  <li><code>name: str</code>: The name of the player</li>
  <li><code>get_result</code>: A coroutine function that accepts a Python expression (a <code>str</code>) and returns the player's guess of the value of that expression</li>
  <li><code>expressions: list[str]</code>: A list of expressions to evaluate</li>
  <li><code>first: dict[str, str]</code>: A dictionary mapping expressions to the name of first player that correctly evaluated that expression</li>
</ul>

<p><code>run_challenges</code> finds the first expression that hasn't yet been correctly evaluated by any player and uses the <code>get_result</code> coroutine function to evaluate it. If the expression was evaluated correctly, <code>run_challenges</code> updates <code>first</code> to contain the name of the player who evaluated the expression correctly first.  <code>run_challenges</code> continues to try to evaluate expressions that haven't yet been evaluated correctly until there are no un-evaluated expressions left.</p>

<p>After <code>run_challenges</code> is called concurrently for 2 players, <code>first</code> should contain a mapping of each expression to the first player who correctly evaluated that expression.  Keep in mind that a player may start evaluating a particular expression first, but take longer than the other player to reach the correct answer.</p>

<p>Here's an example call to <code>run_challenge</code>:</p>

<pre><code>def race_example():
    &quot;&quot;&quot;Run an example with a simulated user input.

    &gt;&gt;&gt; race_example()
    &gt;&gt;&gt; print(asyncio.run(run_challenge(&quot;fake human&quot;)))
    &#x2d;&#x2d; Good job fake human; you correctly evaluated &#x27;1 + 1&#x27; &#x2d;&#x2d;
    &#x2d;&#x2d; Good job fake human; you correctly evaluated &#x27;[1, 2].append([5, 6])&#x27; &#x2d;&#x2d;
    &#x2d;&#x2d; Good job computer; you correctly evaluated &#x27;1 + 1&#x27; &#x2d;&#x2d;
    &#x2d;&#x2d; Not quite fake human. Try to evaluate &#x27;[1, 2] + [5, 6]&#x27; again! &#x2d;&#x2d;
    &#x2d;&#x2d; Good job computer; you correctly evaluated &#x27;[1, 2] + [5, 6]&#x27; &#x2d;&#x2d;
    &#x2d;&#x2d; Not quite fake human. Try to evaluate &#x27;[1, 2] + [5, 6]&#x27; again! &#x2d;&#x2d;
    {&#x27;1 + 1&#x27;: &#x27;fake human&#x27;, &#x27;[1, 2].append([5, 6])&#x27;: &#x27;fake human&#x27;, &#x27;[1, 2] + [5, 6]&#x27;: &#x27;computer&#x27;}
    &quot;&quot;&quot;
    # Swap this simulated &quot;fake human&quot; response function for the one that gets input
    async def mock_get_input_from_user(expression):
        if expression in [&#x27;1 + 1&#x27;, &#x27;[1, 2].append([5, 6])&#x27;]:
            await asyncio.sleep(0.1)
            return str(eval(expression))
        else:
            await asyncio.sleep(0.2)
            return &#x27;incorrect&#x27;
    global get_input_from_user
    get_input_from_user = mock_get_input_from_user</code></pre>



<p>You may not need multiple lines in all of the multiline inputs.</p>

<p>It could be fun to copy this code to your laptop to try to see if you can beat the computer!  You can work as a group to come up with a new challenge list of Python expressions.</p>

<alwaystoggle prompt="Hint: updating first">
The <code>first</code> dictionary might have changed between when <code>get_next_expression</code> was called and <code>result.strip() == correct_answer</code> was checked because <code>get_result</code> is a coroutine (and should be <code>await</code>ed).  Therefore, make sure to check the contents of <code>first</code> again before modifying it rather than assuming something about its contents.
</alwaystoggler>

<alwaystoggle prompt="Hint: calling run_challenges">
Call <code>run_challenges</code> twice from within <code>run_challenge</code>, once with <code>player</code> as the player and once with <code>&#x27;computer&#x27;</code> as the player. Since those calls should be run concurrently, use <code>asyncio.gather</code>, which must be <code>await</code>ed to run.
</alwaystoggler>


            <div class="monaco-storable" id="race-input" style="height:990px;"></div>
            <!-- <a href="javascript:void" id="modal-link-race-input">Run in 61A Code</a> -->
            <div class="modal fade" id="modal-race-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-race-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor('def get_next_expression(expressions, first) &#x2d;&gt; str:\n    &quot;&quot;&quot; Return the lowest index expression in expressions that&#x27;s not in first,\n        or an empty string if all expressions are in first.\n\n    &gt;&gt;&gt; get_next_expression([&#x27;1 + 1&#x27;, &#x27;[1, 2] + [5, 6]&#x27;], {})\n    &#x27;1 + 1&#x27;\n    &gt;&gt;&gt; get_next_expression([&#x27;1 + 1&#x27;, &#x27;[1, 2] + [5, 6]&#x27;], {&#x27;1 + 1&#x27;: &#x27;John&#x27;})\n    &#x27;[1, 2] + [5, 6]&#x27;\n    &gt;&gt;&gt;\n    &gt;&gt;&gt; get_next_expression([&#x27;1 + 1&#x27;], {&#x27;1 + 1&#x27;: &#x27;John&#x27;})\n    &#x27;&#x27;\n    &quot;&quot;&quot;\n    "*** YOUR CODE HERE ***"\n\nasync def run_challenges(name: str, get_result, expressions: list[str], first: dict[str, str]):\n    expression = get_next_expression(expressions, first)\n    while ____:\n        result = ____\n\n        correct_answer = str(eval(expression))\n        if result.strip() == correct_answer:\n            print(f&quot;&#x2d;&#x2d; Good job {name}; you correctly evaluated &#x27;{expression}&#x27; &#x2d;&#x2d;&quot;)\n            "*** YOUR CODE HERE ***"\n        else:\n            print(f&quot;&#x2d;&#x2d; Not quite {name}. Try to evaluate &#x27;{expression}&#x27; again! &#x2d;&#x2d;&quot;)\n        "*** YOUR CODE HERE ***"\n\nasync def get_input_from_user(expression):\n    print(&#x27;What does the following Python expression evaluate to&#x27;, expression)\n    return await asyncio.to_thread(sys.stdin.readline)\n\nasync def get_input_from_computer(expression: str):\n    &quot;&quot;&quot;Return the result of evaluating the expression, after 0.3 seconds.&quot;&quot;&quot;\n    await asyncio.sleep(0.3)\n    return str(eval(expression))\n\nasync def run_challenge(player: str):\n    &quot;&quot;&quot; Return a dictionary mapping each expression to the player name that evaluated it first.\n        One player reads from stdin using the get_input_from_user coroutine and has name player, and the other\n        is named &#x27;computer&#x27; and gets input using get_input_from_computer.&quot;&quot;&quot;\n    expressions = [&#x27;1 + 1&#x27;, &#x27;[1, 2].append([5, 6])&#x27;, &#x27;[1, 2] + [5, 6]&#x27;]\n    "*** YOUR CODE HERE ***"\n\n', "python", "race-input"));
            </script>
        
<script>
    $('.alwaystoggle').css('display', 'inline-block');
    $('.alwaystoggle').click(function() {
      var solution_id = $(this).attr('id');
      $('div.' + solution_id).slideToggle(600);
    });
</script>

  </div>

  <div class='col-md-3 sticky'>
    <nav class='hidden-print hidden-sm hidden-xs sidebar'>
      <ul>
  <li><a href="#attendance">Attendance</a></li>
  <li><a href="#getting-started">Getting Started</a></li>
  <li><a href="#python-coroutines">Python Coroutines</a></li>
  <ul>
    <li><a href="#q1-understanding-concurrent-execution">Q1: Understanding Concurrent Execution</a></li>
  </ul>
  <li><a href="#implementing-a-wwpd-race">Implementing a WWPD Race</a></li>
  <ul>
    <li><a href="#q2-status">Q2: Status</a></li>
    <li><a href="#q3-wait-for-user-input">Q3: Wait for User Input</a></li>
    <li><a href="#q4-timer">Q4: Timer</a></li>
    <li><a href="#q5-what-would-python-do">Q5: What Would Python Do</a></li>
    <li><a href="#q6-wwpd-race">Q6: WWPD Race</a></li>
  </ul>
</ul>
    </nav>
  </div>
</div>

    </main>

    <!-- <footer class="container">
      <div class="row text-center">
        <div class="col col-sm-4">
          <h3><a href="/">CS 61A</a></h3>
          <ul class="nav nav-pills nav-stacked">
            <li><a href="/weekly">Weekly Schedule</a></li>
            <li><a href="/office-hours">Office Hours</a></li>
            <li><a href="/staff">Staff</a></li>
          </ul>
        </div>
        <div class="col col-sm-4">
          <h3><a href="/resources">Resources</a></h3>
          <ul class="nav nav-pills nav-stacked">
            <li><a href="/articles/studying">Studying Guide</a></li>
            <li><a href="/articles/debugging">Debugging Guide</a></li>
            <li><a href="/articles/composition">Composition Guide</a></li>
            <li><a href="/articles/pair-programming">Pair Programming</a></li>
          </ul>
        </div>
        <div class="col col-sm-4">
          <h3><a href="/articles/about">Policies</a></h3>
          <ul class="nav nav-pills nav-stacked">
            <li><a href="/articles/about#assignments">Assignments</a></li>
            <li><a href="/articles/about#exams">Exams</a></li>
            <li><a href="/articles/about#grading">Grading</a></li>
          </ul>
        </div>
      </div>
    </footer> -->

    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/loader.min.js"></script>
  <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/editor/editor.main.min.css">
  <script>
      require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs' }});
      window.MonacoEnvironment = { getWorkerUrl: () => URL.createObjectURL(new Blob([`
      self.MonacoEnvironment = {
          baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min'
      };
      importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/base/worker/workerMain.min.js');
  `], { type: 'text/javascript' }))
  };
  </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.15.5/js/jsplumb.min.js"></script>
    <script src="/assets/js/network_storage.js"></script>
    <script src="/assets/js/code_tabindex.js"></script>
    <script src="/assets/js/storable.js"></script>
    <script src="/assets/js/editor.js"></script>
    <script src="/assets/js/copy-button.js"></script>
    <script src="/assets/js/env-diagram.js"></script>
    
<!-- <script src="/assets/js/sketchy.js"></script> -->
<script>
  $('.sidebar ul').addClass('nav nav-stacked noselect');
  $('body').scrollspy({
    target: '.sidebar',
    offset: 40
  });

  function goToId(id) {
    var target = $(id);
    target.parent().show();
    $('html,body').animate({
      scrollTop: target.offset().top,
    }, 100);
    $("body").scrollspy('refresh');
  }

  if (location.hash) {
    setTimeout(function() {
      if (location.hash) {
        goToId(location.hash);
      }
    }, 1);
  }

  $("a").click(function(event) {
    var urlBeforeHashRegEx = new RegExp("^"+window.location.href.split("#")[0]);
    if (/^#/.test(this.hash) && urlBeforeHashRegEx.test(this.href)) {
      event.preventDefault();
      goToId(this.hash);
      document.location.hash = this.hash;
    }
  });
</script>

  </body>
</html>